import {drawPixels} from './utils'

export function renderCatSideView(ctx, options = {
  pose: 'idle',
  flipX: false,
  frameIndex: 0,
  scale: 2,
  colors: [
    'rgba(0,0,0,0)',
    '#000000',
    '#a2998d',
    '#5c5751',
    '#413f3a',
    '#ecdcc9',
    '#f26060',
  ],
}) {
  const frames = [
    [
      `000000000001000100`,
      `000000000012101210`,
      `000000000126313610`,
      `001110001233333331`,
      `012231001233333331`,
      `123151001334333431`,
      `131010001331353131`,
      `131000111333565331`,
      `134111553435555510`,
      `013322233343222100`,
      `013333333334441100`,
      `013333333333324100`,
      `013344444444331000`,
      `013411111111141000`,
      `013113000141013100`,
      `012100000131001210`,
    ],
    [
      `0000000000001000100`,
      `0000000000012101210`,
      `0000000000126313610`,
      `0000000001233333331`,
      `0011100001233333331`,
      `0122310001334333431`,
      `1231510001331353131`,
      `1310100111333565331`,
      `1311111553435555510`,
      `0133222233343222100`,
      `0133333333334441100`,
      `0133333333333324100`,
      `1113333444443324110`,
      `2334441111114331430`,
      `1111110000001311110`,
      `0000131000001210000`,
    ],
    [
      `000000000001000100`,
      `000000000012101210`,
      `000000000126313610`,
      `001110001233333331`,
      `012231001233333331`,
      `123151001334333431`,
      `131010001331353131`,
      `131000111333565331`,
      `134111553435555510`,
      `013322233343222100`,
      `013333333334441100`,
      `013333333333323100`,
      `014333114433321000`,
      `001443321143311000`,
      `014111110013114100`,
      `013100000012101310`,
    ],
    [
      `000000000001000100`,
      `000000000012101210`,
      `000000000126313610`,
      `001110001233333331`,
      `012231001233333331`,
      `123151001334333431`,
      `131010001331353131`,
      `131000111333565331`,
      `134111553435555510`,
      `013322233343222100`,
      `013333333334441100`,
      `013333333333324100`,
      `013344444444331000`,
      `013411111111141000`,
      `013113000141013100`,
      `012100000131001210`,
    ],
  ]
  const idleFrames = [
    [
      `000000000001000100`,
      `000000000012101210`,
      `000000000126313610`,
      `001110001233333331`,
      `012231001233333331`,
      `123151001334333431`,
      `131010001331353131`,
      `131000111333565331`,
      `134111553435555510`,
      `013322233343222100`,
      `013333333334441100`,
      `014333333333323100`,
      `001334444433323100`,
      `001341111143411000`,
      `001314100013141000`,
      `001213100012131000`,
    ],
  ]
  const jumpingFrames = [
    [
      `000000000001000100`,
      `000000000012101210`,
      `001110000126313610`,
      `012231001233333331`,
      `123141001233333331`,
      `131010001332333231`,
      `131000111331353131`,
      `134111441333565331`,
      `013322233435555510`,
      `013333333343222100`,
      `113344443334444110`,
      `233411111111133320`,
      `111100000000011110`,
    ],
  ]
  const poopingFrame = [
    [
      `0000000000000001000100`,
      `0000000000000012101210`,
      `0000000000000126313610`,
      `0000000000001233333331`,
      `0000000000001233333331`,
      `0000000000001334333431`,
      `1100000000001331353131`,
      `5211000000001333565331`,
      `1123111001113435555510`,
      `0011434112553343222100`,
      `0000143323233334441100`,
      `0000013333333333324100`,
      `0000014333444433324100`,
      `0000001434111143414100`,
      `0000000134100013141000`,
      `0000000121310012131000`,
    ]
  ]
  const attackingFrames = [
    [
      `00000000000000000000`,
      `00000000000100010000`,
      `00000000001210121000`,
      `00000000012631361000`,
      `00000000123333333100`,
      `00111000123333333100`,
      `01223100133233323100`,
      `12314100133135313100`,
      `13101001133356533100`,
      `13311115343555551000`,
      `01233222334322241107`,
      `00133333333444114317`,
      `00143334444333231107`,
      `00013341111434110070`,
      `00013411000131000700`,
      `00012131000121077000`,
    ],
    [
      `00000000000000000000`,
      `00000000000100010000`,
      `00000000001210121000`,
      `00000000012631361000`,
      `00000000123333333100`,
      `00111000123333333100`,
      `01223100133233323100`,
      `12314100133135313100`,
      `13101001133356533100`,
      `13311115343555551000`,
      `01233222334322241107`,
      `00133333333444114317`,
      `00143334444333231107`,
      `00013341111434110070`,
      `00013411000131000700`,
      `00012131000121077000`,
    ],
  ]
  let frame
  if (options.pose === 'idle') {
    frame = idleFrames?.[options.frameIndex] ?? idleFrames[0]
  } else if (options.pose === 'jump') {
    frame = jumpingFrames?.[options.frameIndex] ?? jumpingFrames[0]
  } else if (options.pose === 'attack') {
    frame = attackingFrames?.[options.frameIndex] ?? attackingFrames[0]
  } else if (options.pose === 'poop') {
    frame = poopingFrame?.[options.frameIndex] ?? poopingFrame[0]
  } else {
    frame = frames?.[options.frameIndex] ?? frames[0]
  }
  ctx.fillStyle = 'rgba(0,0,0)'
  ctx.fillRect(0, 0, options.width, options.height)
  drawPixels(ctx, frame, {
    scale: options.scale,
    flipX: options.flipX,
    colors: options.colors,
    shiftY: options.heightShift,
  })
}

export function updateSprite(sprite, dt, options = {}) {
  const {
    attackFrames = 2,
    frameDelay = 0.07,
  } = options
  sprite.dt += dt
  if (sprite.dt > frameDelay) {
    sprite.frame = (sprite.frame + 1) % (sprite.isAttacking ? attackFrames : sprite.framesLength)
    sprite.dt = 0
  }
  sprite.dvl = Math.max(0, sprite.dvl - sprite.dt)
}
