import {drawPixels} from './utils'

export function renderCatSideView(ctx, options = {
  pose: 'idle',
  flipX: false,
  frameIndex: 0,
  scale: 2,
  colors: [
    'rgba(0,0,0,0)',
    '#000000',
    '#a2998d',
    '#5c5751',
    '#413f3a',
    '#ecdcc9',
    '#f26060',
  ],
}) {
  const frames = [
    [
      `00000000000010001000`,
      `00000000000121012100`,
      `00000000001263136100`,
      `00011100012333333310`,
      `00122310012333333310`,
      `01231510013343334310`,
      `01310100013313531310`,
      `01310001113335653310`,
      `01341115534355555100`,
      `00133222333432221000`,
      `00133333333344411000`,
      `00133333333333241000`,
      `00133444444443310000`,
      `00134111111111410000`,
      `00131130001410131000`,
      `00121000001310012100`,
    ],
    [
      `00000000000010001000`,
      `00000000000121012100`,
      `00000000001263136100`,
      `00000000012333333310`,
      `00111000012333333310`,
      `01223100013343334310`,
      `12315100013313531310`,
      `13101001113335653310`,
      `13111115534355555100`,
      `01332222333432221000`,
      `01333333333344411000`,
      `01333333333333241000`,
      `11133334444433241100`,
      `23344411111143314300`,
      `11111100000013111100`,
      `00001310000012100000`,
    ],
    [
      `00000000000010001000`,
      `00000000000121012100`,
      `00000000001263136100`,
      `00011100012333333310`,
      `00122310012333333310`,
      `01231510013343334310`,
      `01310100013313531310`,
      `01310001113335653310`,
      `01341115534355555100`,
      `00133222333432221000`,
      `00133333333344411000`,
      `00133333333333231000`,
      `00143331144333210000`,
      `00014433211433110000`,
      `00141111100131141000`,
      `00131000000121013100`,
    ],
    [
      `00000000000010001000`,
      `00000000000121012100`,
      `00000000001263136100`,
      `00011100012333333310`,
      `00122310012333333310`,
      `01231510013343334310`,
      `01310100013313531310`,
      `01310001113335653310`,
      `01341115534355555100`,
      `00133222333432221000`,
      `00133333333344411000`,
      `00133333333333241000`,
      `00133444444443310000`,
      `00134111111111410000`,
      `00131130001410131000`,
      `00121000001310012100`,
    ],
  ]
  const idleFrames = [
    [
      `00000000000010001000`,
      `00000000000121012100`,
      `00000000001263136100`,
      `00011100012333333310`,
      `00122310012333333310`,
      `01231510013343334310`,
      `01310100013313531310`,
      `01310001113335653310`,
      `01341115534355555100`,
      `00133222333432221000`,
      `00133333333344411000`,
      `00143333333333231000`,
      `00013344444333231000`,
      `00013411111434110000`,
      `00013141000131410000`,
      `00012131000121310000`,
    ],
  ]
  const jumpingFrames = [
    [
      `000000000000000000`,
      `000000000000000000`,
      `000000000000000000`,
      `000000000001000100`,
      `000000000012101210`,
      `001110000126313610`,
      `012231001233333331`,
      `123141001233333331`,
      `131010001332333231`,
      `131000111331353131`,
      `134111441333565331`,
      `013322233435555510`,
      `013333333343222100`,
      `113344443334444110`,
      `233411111111133320`,
      `111100000000011110`,
    ],
  ]
  const poopingFrame = [
    [
      `0000000000000001000100`,
      `0000000000000012101210`,
      `0000000000000126313610`,
      `0000000000001233333331`,
      `0000000000001233333331`,
      `0000000000001334333431`,
      `1100000000001331353131`,
      `5211000000001333565331`,
      `1123111001113435555510`,
      `0011434112553343222100`,
      `0000143323233334441100`,
      `0000013333333333324100`,
      `0000014333444433324100`,
      `0000001434111143414100`,
      `0000000134100013141000`,
      `0000000121310012131000`,
    ]
  ]
  const attackingFrames = [
    [
      `00000000000000000000`,
      `00000000000100010000`,
      `00000000001210121000`,
      `00000000012631361000`,
      `00000000123333333100`,
      `00111000123333333100`,
      `01223100133233323100`,
      `12314100133135313100`,
      `13101001133356533100`,
      `13311115343555551000`,
      `01233222334322241107`,
      `00133333333444114317`,
      `00143334444333231107`,
      `00013341111434110070`,
      `00013411000131000700`,
      `00012131000121077000`,
    ],
    [
      `00000000000000000000`,
      `00000000000100010000`,
      `00000000001210121000`,
      `00000000012631361000`,
      `00000000123333333100`,
      `00111000123333333100`,
      `01223100133233323100`,
      `12314100133135313100`,
      `13101001133356533100`,
      `13311115343555551000`,
      `01233222334322241107`,
      `00133333333444114317`,
      `00143334444333231107`,
      `00013341111434110070`,
      `00013411000131000700`,
      `00012131000121077000`,
    ],
  ]
  let frame
  if (options.pose === 'idle') {
    frame = idleFrames?.[options.frameIndex] ?? idleFrames[0]
  } else if (options.pose === 'jump') {
    frame = jumpingFrames?.[options.frameIndex] ?? jumpingFrames[0]
  } else if (options.pose === 'attack') {
    frame = attackingFrames?.[options.frameIndex] ?? attackingFrames[0]
  } else if (options.pose === 'poop') {
    frame = poopingFrame?.[options.frameIndex] ?? poopingFrame[0]
  } else {
    frame = frames?.[options.frameIndex] ?? frames[0]
  }
  ctx.fillStyle = 'rgba(0,0,0)'
  ctx.fillRect(0, 0, options.width, options.height)
  drawPixels(ctx, frame, {
    scale: options.scale,
    flipX: options.flipX,
    colors: options.colors,
    shiftY: options.heightShift,
  })
}

export function updateSprite(sprite, dt, options = {}) {
  const {
    attackFrames = 2,
    frameDelay = 0.07,
  } = options
  sprite.dt += dt
  if (sprite.dt > frameDelay) {
    sprite.frame = (sprite.frame + 1) % (sprite.isAttacking ? attackFrames : sprite.framesLength)
    sprite.dt = 0
  }
  sprite.dvl = Math.max(0, sprite.dvl - sprite.dt)
}
